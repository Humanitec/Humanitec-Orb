description: >
  Get credentials for Humanitec registry
parameters:
  humanitec_api:
    description: "URL of the Humanitec API"
    type: string
    default: "api.humanitec.io"
  organization:
    description: "Name of the organization in Humanitec"
    type: string
    default: ""
steps:
  - run:
      name: "Get Humanitec Registry Credentials" 
      command: |
        HUMANITEC_REGISTRY_CREDS=$(curl -XGET -H 'Authorization:Bearer '$HUMANITEC_TOKEN'' 'https://'<< parameters.humanitec_api >>'/orgs/'<< parameters.organization >>'/registries/humanitec/creds' | jq .)
        HUMANITEC_REGISTRY_USERNAME=$(echo $HUMANITEC_REGISTRY_CREDS | jq .username | tr -d '"')
        HUMANITEC_REGISTRY_PASSWORD=$(echo $HUMANITEC_REGISTRY_CREDS | jq .password | tr -d '"')
        HUMANITEC_REGISTRY_URL=$(echo $HUMANITEC_REGISTRY_CREDS | jq .registry | tr -d '"')
        echo "export HUMANITEC_REGISTRY_USERNAME=$HUMANITEC_REGISTRY_USERNAME" >> $BASH_ENV
        echo "export HUMANITEC_REGISTRY_PASSWORD=$HUMANITEC_REGISTRY_PASSWORD" >> $BASH_ENV
        echo "export HUMANITEC_REGISTRY_URL=$HUMANITEC_REGISTRY_URL" >> $BASH_ENV
